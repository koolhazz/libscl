#!/bin/sh


# ******************************************************************************
#
# ******************************************************************************

[ -z "${COLUMNS}" ] && COLUMNS=80 # Set a sane screen width.
COLOR_FAIL="echo -en \\033[1;31m"
COLOR_PASS="echo -en \\033[0;32m"
COLOR_NORM="echo -en \\033[0;39m"


# ******************************************************************************
#
# ******************************************************************************

CWD=`pwd`
SRCDIR=`expr ${CWD} : "\(.*\)/t"`/src


# ******************************************************************************
#
# ******************************************************************************

echo_str() {
	local l=${#1}
	local i=`expr ${l} + 1`
	local j=`expr ${COLUMNS} - 9`
	while [ ${i} -lt ${j} ]; do
		echo -en "."
		i=`expr ${i} + 1`
	done
}

stat_fail() {
	echo_str "$1"
	echo -en " [ "
	${COLOR_FAIL}
	echo -en "FAIL"
	${COLOR_NORM}
	echo " ]"
}

stat_pass() {
	echo_str "$1"
	echo -en " [ "
	${COLOR_PASS}
	echo -en "PASS"
	${COLOR_NORM}
	echo " ]"
}


# ******************************************************************************
#
# ******************************************************************************

LD_LIBRARY_PATH=${SRCDIR} ./tconfig0
for d in t*; do
	[ ! -d ${d} ] && continue
	for f in ${d}[1-9]; do
		[ ! -x ${f} ] && continue
                t="`LD_LIBRARY_PATH=${SRCDIR} ./${f} -t`"
		echo -en "${t} "
		if [ -z "`LD_LIBRARY_PATH=${SRCDIR} ./${f} | grep FAIL`" ]; then
			stat_pass "${t}"
		else
			stat_fail "${t}"
		fi
	done
done


# ******************************************************************************
#
# ******************************************************************************

unset -v d
unset -v f
unset -v t

unset -v CWD
unset -v SRCDIR


# ******************************************************************************
#
# ******************************************************************************

exit 0
